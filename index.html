<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Fundraiser</title>

  <style>
    :root{
      --bg:#fff; --text:#111827; --muted:#6b7280; --border:#e5e7eb;
      --soft:#f3f4f6; --fill:#111827; --radius:18px;
    }
    body{margin:0;padding:18px;background:#fafafa;color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    .wrap{max-width:760px;margin:0 auto;}
    .card{background:var(--bg);border:1px solid var(--border);
      border-radius:var(--radius);box-shadow:0 8px 26px rgba(0,0,0,.06);}
    .pad{padding:18px 20px;}
    .top{display:flex;justify-content:space-between;gap:12px;}
    h1{margin:0;font-size:20px;}
    .sub{color:var(--muted);font-size:13px;margin-top:4px;}
    .amount{font-weight:900;font-size:18px;}
    .bar{margin-top:14px;height:14px;background:var(--soft);
      border-radius:999px;overflow:hidden;}
    .fill{height:100%;width:0%;background:var(--fill);
      transition:width .8s ease;}
    .row{display:flex;justify-content:space-between;
      margin-top:10px;font-size:12px;color:var(--muted);}
    .pill{border:1px solid var(--border);padding:3px 9px;
      border-radius:999px;background:#fff;}
    .grid{display:grid;grid-template-columns:1fr 1fr;
      gap:10px;margin-top:14px;}
    .box{border:1px solid var(--border);border-radius:14px;padding:12px;}
    .label{font-size:12px;color:var(--muted);}
    .value{margin-top:4px;font-weight:800;}
    .cta{display:flex;gap:10px;margin-top:12px;}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid var(--border);
      background:#fff;font-weight:700;cursor:pointer;}
    .btn.primary{background:var(--fill);color:#fff;}
    .qrWrap{display:none;gap:12px;margin-top:12px;}
    .qr{width:92px;height:92px;border-radius:14px;border:1px solid var(--border);}
    .status{border-top:1px solid var(--border);
      padding:12px 20px;font-size:13px;}
    .err{color:#b91c1c;font-size:13px;}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="pad">
      <div class="top">
        <div>
          <h1>Support my personal project</h1>
          <div class="sub">
            Goal: <span id="goalTxt">â€”</span> â€¢
            Minimum: <span id="minTxt">â€”</span> â€¢
            Deadline: <span id="endTxt">â€”</span>
          </div>
        </div>
        <div class="amount" id="raisedTxt">â€”</div>
      </div>

      <div class="bar"><div class="fill" id="fill"></div></div>

      <div class="row">
        <div>Updated: <strong id="updatedTxt">â€”</strong></div>
        <div class="pill" id="daysLeft">â€”</div>
      </div>

      <div class="grid">
        <div class="box">
          <div class="label">Minimum milestone</div>
          <div class="value" id="minStatus">â€”</div>
        </div>
        <div class="box">
          <div class="label">Remaining to goal</div>
          <div class="value" id="remainingTxt">â€”</div>
        </div>
      </div>

      <div class="cta">
        <button class="btn primary" id="btnIban">Copy IBAN</button>
        <a class="btn" id="btnPayconiq" target="_blank">Payconiq</a>
      </div>

      <div class="qrWrap" id="qrWrap">
        <img class="qr" id="qrImg"/>
        <div>
          <strong>Payconiq</strong><br/>
          Scan the QR
        </div>
      </div>

      <div class="err" id="error"></div>
    </div>

    <div class="status" id="statusTxt">Loadingâ€¦</div>
  </div>
</div>

<script>
  const DATA_URL = "https://script.google.com/macros/s/AKfycbx-lv0ySd615cHQSlJ6mU3n3kuQXp4cx7dnF1SOi0_INqWQQiP-rBebmENo7McjP1am/exec";
  const TOKEN = "4444";
  const REFRESH_MS = 60000;

  const fmtEUR = n =>
    new Intl.NumberFormat("fr-BE", {style:"currency",currency:"EUR",maximumFractionDigits:0})
      .format(n || 0);

  function loadData() {
    fetch(`${DATA_URL}?token=${TOKEN}&_=${Date.now()}`)
      .then(r => r.json())
      .then(d => {
        if (d.error) throw new Error(d.error);
        render(d);
      })
      .catch(() => {
        document.getElementById("error").textContent = "Data unavailable";
      });
  }

  function render(d) {
    const pct = Math.min(100, Math.round(d.raised / d.goal * 100));
    document.getElementById("fill").style.width = pct + "%";

    set("goalTxt", fmtEUR(d.goal));
    set("minTxt", fmtEUR(d.minimum));
    set("raisedTxt", fmtEUR(d.raised) + ` (${pct}%)`);
    set("updatedTxt", d.updated);
    set("endTxt", d.endDate);

    set("remainingTxt", d.goal - d.raised <= 0 ? "ðŸŽ¯ Reached" : fmtEUR(d.goal - d.raised));
    set("minStatus", d.raised >= d.minimum ? "âœ… Reached" : fmtEUR(d.minimum - d.raised));

    const days = Math.ceil((new Date(d.endDate) - Date.now()) / 86400000);
    set("daysLeft", days > 0 ? `${days} days left` : "Ended");

    document.getElementById("btnIban").onclick = () => {
      navigator.clipboard.writeText(d.iban);
      alert("IBAN copied");
    };

    if (d.payconiqQr) {
      document.getElementById("qrImg").src = d.payconiqQr;
      document.getElementById("qrWrap").style.display = "flex";
    }

    document.getElementById("btnPayconiq").href = d.payconiqUrl;
  }

  function set(id, txt) {
    document.getElementById(id).textContent = txt;
  }

  loadData();
  setInterval(loadData, REFRESH_MS);
</script>
</body>
</html>
